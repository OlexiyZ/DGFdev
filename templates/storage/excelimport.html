<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Excel Operations</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        function uploadFile() {
            // Получаем файл из input
            var fileInput = document.getElementById('excelFile');
            var file = fileInput.files[0]; // Берем первый выбранный файл

            if (!file) {
                alert("Пожалуйста, выберите файл для загрузки.");
                return;
            }

            // Создаем FormData объект для передачи файла
            var formData = new FormData();
            formData.append('excelFile', file);

            // Используем fetch API для отправки файла на сервер
            fetch('/storage/upload_file/', { // Укажите здесь URL вашего серверного скрипта для обработки загрузки '/upload-path'
                method: 'POST',
                body: formData,
            })
            .then(response => response.json()) //.json()) // предполагается, что сервер возвращает JSON
            .then(html => {
            console.log("html", html);
            fSelect = document.querySelector('#firstSelect')
            for (let key in html) {
                const newOption = document.createElement('option')
                newOption.textContent = key
                newOption.value = html[key]
                fSelect.appendChild(newOption)
            }
            })
        }
    </script>

</head>
<body id="content">

<h2>Excel Operations</h2>

<form id="uploadForm" enctype="multipart/form-data" method="post">
    {% csrf_token %}
    <input type="file" id="excelFile" name="excelFile" accept=".xlsx, .xls" required>
    <button type="button" onclick="uploadFile()">Upload Excel File</button>
</form>

<select id="firstSelect"></select>

<button id="confirmBtn">Confirm Sheet</button>

<select id="secondSelect"></select>


<button id="display-table-data" type="button">Display Table Data</button>

<!-- Button to Load Excel Data to Database -->
<!-- <form method="post" action="/url-to-load-data/"> -->
    {% csrf_token %}
    <button id="sendButton" type="submit">Load Excel Data to Database</button>
<!-- </form> -->
<script>
    console.log(1)
    document.getElementById('confirmBtn').addEventListener('click', function() {
        // Get the selected value from the first select

        // Clear existing options in the second select
        const selctedOption = document.querySelector('#firstSelect')
        console.log("fSelect: ", fSelect);
        console.log("selctedOption.value", selctedOption.value)
        var secondSelect = document.getElementById('secondSelect');
        secondSelect.innerHTML = '';
        const dataToUse = selctedOption.value.split(',')
        // Fill the second select with new options
        dataToUse.forEach(function(item) {
            var opt = document.createElement('option');
            console.log(opt);
            opt.value = item;
            opt.innerHTML = item;
            secondSelect.appendChild(opt);
        });
    });
    $('#sendButton').click(function() {
        console.log($('#firstSelect').text());
        console.log($('#secondSelect').val());
        $.ajax({
            url: '/storage/select_table/',
            type: 'POST',
            data: {
                'sheet': $('#firstSelect').text(),
                'table': $('#secondSelect').val(),
                'csrfmiddlewaretoken':$('input[name="csrfmiddlewaretoken"]').val()
            }
        })
    })
</script>
</body>
</html>
